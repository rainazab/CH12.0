# Elastic Agent Configuration for API Atlas
# This file configures monitoring agents for API performance tracking

name: api-atlas-monitoring
description: "Real-time API performance monitoring for API Atlas platform"

# Agent policies
policies:
  - name: api-performance-monitoring
    description: "Monitor API response times, uptime, and error rates"
    package: system
    inputs:
      - type: system/metrics
        enabled: true
        streams:
          - metrics: ["*"]
            data_stream:
              dataset: api-atlas.performance

# Data streams
data_streams:
  - name: api-atlas-performance
    description: "API performance metrics"
    indices:
      - api-atlas-performance-default
    mappings:
      properties:
        api_id:
          type: keyword
        timestamp:
          type: date
        response_time_ms:
          type: integer
        status:
          type: keyword
        error_rate:
          type: float
        region:
          type: keyword

# Monitoring schedule
schedule:
  interval: 5m  # Check every 5 minutes
  timeout: 30s  # Timeout after 30 seconds

# Alerting rules
alerts:
  - name: high_response_time
    condition: response_time_ms > 2000
    severity: warning
    message: "API {{api_id}} has high response time: {{response_time_ms}}ms"

  - name: api_down
    condition: status == "down"
    severity: critical
    message: "API {{api_id}} is down"

  - name: high_error_rate
    condition: error_rate > 0.05
    severity: warning
    message: "API {{api_id}} has high error rate: {{error_rate}}%"
